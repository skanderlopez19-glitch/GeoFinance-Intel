# .github/workflows/daily_update.yml

name: Actualizaci√≥n Diaria Geo-Financiera

on:
  # Ejecuta el workflow a las 10:00 AM UTC todos los d√≠as
  schedule:
    - cron: '0 10 * * *'
  # Permite ejecutar el workflow manualmente desde la interfaz de GitHub
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
steps:
  - name: ‚¨áÔ∏è Checkout del Repositorio
    uses: actions/checkout@v4

  - name: üêç Configurar Python 3.10
    uses: actions/setup-python@v5
    with:
      python-version: '3.10'

  - name: üì¶ Instalar Dependencias
    run: |
      python -m pip install --upgrade pip
      # Aseguramos que reportlab y todas las dem√°s dependencias est√©n instaladas
      pip install pandas yfinance matplotlib seaborn reportlab

  - name: üìà Ejecutar el Script Python (MAP.PY)
    run: |
      # El script ejecutar√° y generar√° data.json y informe_diario.pdf
      python MAP.PY
    env:
      # Pasar los secretos como variables de entorno al script
      SENDER_EMAIL: ${{ secrets.SENDER_EMAIL }}
      EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      RECEIVER_EMAIL: ${{ secrets.RECEIVER_EMAIL }}


  - name: üíæ Subir Archivos Generados (data.json y PDF)
    uses: stefanzweifel/git-auto-commit-action@v5
    with:
      # Archivos que se actualizar√°n en el repositorio
      file_pattern: 'data.json informe_diario.pdf'
      commit_message: 'ü§ñ BOT: Datos geo-financieros y PDF actualizados autom√°ticamente'
      # Necesario para el push
      commit_user_name: 'github-actions[bot]'
      commit_user_email: 'github-actions[bot]@users.noreply.github.com'
